\chapter{Derived moduli stacks}
\chapterprecistoc{\textup{by} Pieter Belmans}
\begin{flushright}
  Pieter Belmans
\end{flushright}

\begin{refsection}

\section{Introduction}

\section{Preliminaries}
Whenever the terminology ``derived stack'' is used we refer to the~$\mathbf{D}^-$\dash stacks from \cite{hagII}.

\begin{definition}
  Let~$\mathcal{C}$ be a dg~category. The \emph{derived moduli stack of pseudoperfect~$\mathcal{C}^\opp$\dash dg~modules}~$\mathcal{M}_{\mathcal{C}}$ is given by the simplicial presheaf
  \begin{equation}
    \mathcal{M}_{\mathcal{C}}:\scAlg{k}\to\sSet:A^*\mapsto\Map_{\dgCat_K}\left( \mathcal{C}^\opp,\Int_\perf\left( \dgMod{\nerve(A^*)^\bullet}_k \right) \right).
  \end{equation}
\end{definition}

We remark that
\begin{enumerate}
  \item the opposite dg~category is again a dg~category, with composition
    \begin{equation}
      \Hom_{\mathcal{C}^\opp}(X,Y)^p\otimes_k\Hom_{\mathcal{C}^\opp}(Y,Z)^q\to\Hom_{\mathcal{C}^\opp}(X,Z)^{p+q}:f\otimes g\mapsto(-1)^{pq}gf;
    \end{equation}
  \item the simplicial structure of~$\dgCat_k$ is given by
    \begin{equation}
      \Map_{\dgCat_k}(\mathcal{C},\mathcal{D})\coloneqq\Hom_{\dgCat_k}(\Gamma^*(\mathcal{C}),\mathcal{D})
    \end{equation}
    where~$\Gamma^*$ is the cosimplicial resolution functor;
  \item the subcategory of perfect objects is stable under base change.
\end{enumerate}

\begin{definition}
  If we take~$\mathcal{C}=k$ in definition \ref{definition:derived-stack-of-pseudoperfect-objects} we obtain the \emph{derived moduli stack of perfect modules}. It will be denoted~$\RPerf$.
\end{definition}

In the notation of \cite{toen-vaquie} we have~$k=\mathbf{1}$ and~$\RPerf$ is denoted by~$\mathcal{M}_{\mathbf{1}}$.

This derived stack serves as a ``base point'' for all other constructions. One first proves the properties for~$\RPerf$ (see theorem \ref{theorem:main-theorem-RPerf}), then one can try to lift these to derived moduli stacks for arbitraty dg~categories, under some appropriate finiteness conditions (see theorem \ref{theorem:main-theorem}). But first we have to show that it is indeed a derived stack! Recall again that ``derived stack'' should be interpreted in terms of \cite[definition 1.3.2.1]{hagII}.

\begin{theorem}
  \label{theorem:derived-moduli-stack-is-stack}
  The simplicial presheaf~$\mathcal{M}_{\mathcal{C}}$ is a derived stack.

  \begin{proof}[Sketch of a proof]
    By \cite{hagII}\fixthis{how?} the proof is reduced to showing the following three properties:
    \begin{enumerate}
      \item for every weak equivalence~$A^*\weq B^*$ in~$\scAlg{k}$ is the natural morphism
        \begin{equation}
          \Int_\perf\left( \dgMod{\nerve(A^*)^\bullet}_k \right)\weq\Int_\perf\left( \dgMod{\nerve(B^*)^\bullet}_k \right)
        \end{equation}
        a quasi-equivalence;
      \item for every~$A^*$ and~$B^*$ in~$\scAlg{k}$ is the natural morphism
        \begin{equation}
          \Int_\perf\left( \dgMod{\nerve\left( A^*\times B^*)^\bullet}_k \right) \right)\weq\Int_\perf\left( \dgMod{\nerve(A^*)^\bullet}_k \right)\times\Int_\perf\left( \dgMod{\nerve(B^*)^\bullet}_k \right)
        \end{equation}
        a quasi-equivalence;
      \item for every \'etale hypercovering~$X_*\to Y$ in~$\mathbf{D}^-\Aff$, or equivalently a co-augmented cosimplicial object~$A^*\to B_*^*$ in~$\scAlg{k}$ is
        \begin{equation}
          \Int_\perf\left( \dgMod{\nerve(A^*)^\bullet}_k \right)\weq\holim_{[n]\in\Ob(\Delta)}\Int_\perf\left( \dgMod{B_n}_k \right)
        \end{equation}
        a quasi-equivalence.
    \end{enumerate}
    Or in a more sloganesque way\fixthis{this should be used in the actual lecture}
    \begin{enumerate}
      \item $\mathcal{M}_{\mathcal{C}}$ preserves weak equivalences;
      \item $\mathcal{M}_{\mathcal{C}}$ is compatible with finite products;
      \item $\mathcal{M}_{\mathcal{C}}$ is compatible with \'etale hypercovers.
    \end{enumerate}

    \expandthis{write complete proof?}
  \end{proof}
\end{theorem}

\begin{example}
  If we evaluate~$\mathcal{M}_{\mathcal{C}}$ in~$k$ we get
  \begin{equation}
    \Map_{\dgCat_k}\left( \mathcal{C}^\opp,\Int_\perf\left( \dgMod_k \right) \right)
  \end{equation}
  and by \cite{toen} this simplicial set is weakly equivalent to the category of weak equivalences of~$\mathcal{C}^\opp$\dash dg~modules~$M$ such that~$M(C)^\bullet$ is a perfect complex of~$k$\dash modules for every~$C\in\Ob(\mathcal{C})$.\fixthis{full reference to result}
\end{example}


\section{Properties of derived moduli stacks}
Before we describe the properties of~$\RPerf$ and more generally~$\mathcal{M}_{\mathcal{C}}$ we introduce some ideas that are necessary for its proof. A reference for this is \cite[expos\'es I--III]{sga6}.
\begin{definition}
  Let~$A^*$ be a simplicial commutative~$k$\dash algebra. Let~$P^\bullet$ be a~$\nerve(A^*)^\bullet$\dash dg~module. We say it is of \emph{Tor amplitude contained in~$[a,b]$} if for every~$\pi_0(A^*)$\dash module~$M\in\Ob(\pi_0(A^*)\mhyphen\Mod)$ we have
  \begin{equation}
    \HH^i\left( P^\bullet\otimes_{\nerve(A^*)^\bullet}^\LLL M \right)=0
  \end{equation}
  if~$i\notin[a,b]$.
\end{definition}

\begin{theorem}
  \label{theorem:main-theorem-RPerf}
  The derived moduli stack~$\RPerf$ is locally geometric and locally of finite presentation.

  \begin{proof}[Sketch of a proof]
    For the complete proof, see \cite[proposition 3.7]{toen-vaquie}.
    \begin{enumerate}
      \item Let~$a\leq b$ be integers. We will introduce a full derived substack~$\RPerf^{[a,b]}$ of~$\RPerf$.
        
        For~$A^*\in\Ob(\scAlg{k})$ we see that~$\pi_0(\RPerf(A^*))$ consists of the quasi-isomorphism classes of perfect~$\nerve(A^*)^\bullet$\dash dg~modules. Hence we can define~$\RPerf^{[a,b]}(A^*)$ to be the full subsimplicial set of~$\RPerf(A^*)$ of connected components that correspond to perfect~$\nerve(A^*)^\bullet$\dash dg~modules whose Tor amplitude is contained in~$[a,b]$. We can then write
        \begin{equation}
          \RPerf=\bigcup_{a\leq b}\RPerf^{[a,b]}
        \end{equation}
        and we have reduced the proof to showing that~$\RPerf^{[a,b]}$ is locally geometric and locally of finite presentation. We can moreover prove that~$\RPerf^{[a,b]}$ is~$n$\dash geometric, where~$n=b-a+1$.

      \item 
    \end{enumerate}
  \end{proof}
\end{theorem}

\begin{theorem}
  \label{theorem:main-theorem}
  Let~$\mathcal{C}$ be a dg~category of finite type. Then the derived moduli stack~$\mathcal{M}_{\mathcal{C}}$ is locally geometric and locally of finite presentation.
\end{theorem}

\section{Example: derived moduli stack of perfect complexes on a scheme}
Consider a smooth and proper scheme~$X$ over a field~$k$. By~$\Qcoh_X$ we denote its category of quasicoherent sheaves. In general there is no obvious model category structure on~$\Ch(\Qcoh(X))$. But in this case~$X$ is quasicompact and separated, so by \cite{hovey-sheaves} there exists a model category structure on~$\Ch(\Qcoh_X)$ where the cofibrations are the monomorphisms and weak equivalences are quasi-isomorphisms. There is moreover an obvious~$\Ch(k\mhyphen\Mod)$\dash enrichment, so~$\Ch(\Qcoh_X)$ is a~$\Ch(k\mhyphen\Mod)$\dash model category. Using the internal dg~category as seen in definition~\ref{definition:internal-dg-category} we can define
\begin{equation}
  \LLL_\qcoh(X)\coloneqq\Int\left( \Ch(\Qcoh_X) \right).
\end{equation}
By proposition \ref{proposition:internal-category-is-dg-enrichtment} this category serves as a dg~enrichment of the ``standard'' unbounded derived category of quasicoherent sheaves, in the sense that
\begin{equation}
  \mathbf{D}_\qcoh(X)\cong\Ho\left( \LLL_\qcoh(X) \right).
\end{equation}
If we restrict ourselves to the perfect objects in\fixthis{introduce~$\LLL_\perf$} we obtain the equivalence
\begin{equation}
  \mathbf{D}_\perf(X)\cong\Ho\left( \LLL_\perf(X) \right),
\end{equation}
where now the smoothness comes into play.

In order to apply the theory of derived moduli stacks certain finiteness conditions on the categories must be satisfied. Crucial in this is the result from \cite{bondal-vandenbergh}. One could paraphrase the main result as
\begin{quote}
  Quasicompact and quasiseparated\footnote{The intersection of two affine opens is again affine. This is always the case for separated schemes.} schemes are \emph{derived affine}.
\end{quote}
\begin{flushright}
  \cite[corollary 3.1.8]{bondal-vandenbergh}
\end{flushright}
This means that~$\mathbf{D}_\qcoh(X)$ is equivalent to~$\mathbf{D}(A^\bullet)$, where~$A^\bullet$ is a dg~algebra with bounded cohomology. This algebra is moreover obtained by looking at~$\Ext^\bullet(E,E)$ where~$E$ is a compact generator for~$\mathbf{D}_\qcoh(X)$.

We can then define the desired derived moduli stack.
\begin{definition}
  Let~$X$ be as before. We define the \emph{derived moduli stack of perfect complexes on~$X$} as
  \begin{equation}
    \RPerf_X\coloneqq\mathcal{M}_{\LLL_\perf(X)}\cong\HHom_{\mathbf{D}^-\mhyphen\St_k}(X,\RPerf)
  \end{equation}
\end{definition}

\begin{remark}
  We can prove that the dg~category~$\LLL_\perf(X)$ is saturated, so by remark \fixthis{write this remark} we get that~$\RPerf_X$ really classifies objects in~$\LLL_\perf(X)$.
\end{remark}

\begin{remark}
  Given this derived stack we can also consider its truncation, or underived part. We'll denote this higher stack by
  \begin{equation}
    \Perf_X\coloneqq\truncation_0(\RPerf_X).
  \end{equation}
  If one moreover restricts himself to the substack of~$1$\dash rigid objects\footnote{These are objects satisfying the vanishing of all higher homotopy groups for all base changes.} we obtain the classical result of the existence of an Artin stack~$\Coh_X$\checkthis{or $\Vect_X$ as in the introduction?!} that serves as a moduli space for coherent sheaves on~$X$ \cite[th\'eor\`eme 4.6.2.1]{laumon-moret-bailly} \cite[tag 08CW]{stacks}.
\end{remark}

\section{Example: derived moduli stack of pseudoperfect complexes of quiver representations}

\printbibliography[heading = local]

\end{refsection}
